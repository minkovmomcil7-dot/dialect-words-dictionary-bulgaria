<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Речник на диалектни думи</title>
  <style>
    body { font-family: system-ui, Arial; padding: 1rem; max-width: 900px; margin: auto; }
    input[type="text"] { padding: .5rem; width: 100%; margin-bottom: .8rem; box-sizing: border-box; }
    ul { padding-left: 1.2rem; list-style: none; margin: 0; }
    li { padding: .6rem .4rem; border-bottom: 1px solid #eee; }
    .word { font-weight: 700; font-size: 1.05rem; }
    .meta { color: #555; margin-left: .5rem; }
    .meaning { color: #333; margin-top: .25rem; font-size: .95rem; }
    .loading { color: #666; font-style: italic; }
    .error { color: #c00; }
    .small { font-size: .85rem; color:#666; margin-top:.2rem }
  </style>
</head>
<body>
  <h1>Речник на диалектни думи</h1>
  <input id="search" type="text" placeholder="Търси дума, значение или район..." />
  <div id="status" class="loading">Зареждане на данни…</div>
  <ul id="list" aria-live="polite"></ul>

  <!--
    Embedded JSON data from:
    https://github.com/minkovmomcil7-dot/dialect-words-dictionary/blob/main/dialect-dictionary-data.json

    Replace the placeholder below with the full contents of that JSON file.
    Example: copy the entire contents of dialect-dictionary-data.json and paste
    between the script tags below (where it currently has the example array).
    -->
  <script id="dictionary-data" type="application/json">
  [
    /* Paste the full JSON from
       https://github.com/minkovmomcil7-dot/dialect-words-dictionary/blob/main/dialect-dictionary-data.json
       here. The file likely contains a single object or array — paste it exactly,
       preserving quotes and commas. Example small sample shown below: */
    {"word":"бука","dialect":"Троян","meaning":"страх, чудовище","note":"често в приказки"},
    {"word":"бабине","dialect":"Троян","meaning":"бърз метод","note":""},
    {"word":"джангала","dialect":"Троянско","meaning":"гъста растителност","note":"вж. джунгла"}
  ]
  </script>

  <script>
    const statusEl = document.getElementById('status');
    const listEl = document.getElementById('list');
    const searchEl = document.getElementById('search');

    // Parse embedded JSON (data must be valid JSON)
    let items = [];
    try {
      const raw = document.getElementById('dictionary-data').textContent.trim();
      // If the file is a plain array/object it's fine. If it's an object containing `words` use that property.
      const parsed = JSON.parse(raw);
      // If the source JSON has a top-level `words` array, use it; otherwise use parsed directly.
      items = Array.isArray(parsed) ? parsed : (parsed.words && Array.isArray(parsed.words) ? parsed.words : []);
      statusEl.textContent = '';
    } catch (err) {
      statusEl.textContent = 'Грешка при зареждане на данни: ' + err.message;
      statusEl.className = 'error';
      console.error('Failed to parse embedded JSON:', err);
    }

    function escapeHtml(s) {
      return String(s || '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#39;');
    }

    function render(data) {
      listEl.innerHTML = '';
      if (!data || data.length === 0) {
        listEl.innerHTML = '<li><em>Няма резултати.</em></li>';
        return;
      }
      const frag = document.createDocumentFragment();
      for (const it of data) {
        const li = document.createElement('li');
        const word = escapeHtml(it.word || it.term || '');
        const dialect = escapeHtml(it.dialect || it.region || '');
        const meaning = escapeHtml(it.meaning || it.definition || '');
        const note = escapeHtml(it.note || it.comment || '');
        li.innerHTML = '<div><span class="word">' + word + '</span>' +
                       (dialect ? '<span class="meta">(' + dialect + ')</span>' : '') +
                       '</div>' +
                       '<div class="meaning">' + meaning + (note ? ' — ' + note : '') + '</div>';
        frag.appendChild(li);
      }
      listEl.appendChild(frag);
    }

    function applyFilter(q) {
      if (!q) return render(items);
      const ql = q.toLowerCase();
      const filtered = items.filter(it =>
        (it.word && it.word.toLowerCase().includes(ql)) ||
        (it.meaning && it.meaning.toLowerCase().includes(ql)) ||
        (it.dialect && it.dialect.toLowerCase().includes(ql)) ||
        (it.note && it.note.toLowerCase().includes(ql)) ||
        (it.term && it.term.toLowerCase().includes(ql)) ||
        (it.definition && it.definition.toLowerCase().includes(ql))
      );
      render(filtered);
    }

    // initial render
    render(items);

    // search handler
    searchEl.addEventListener('input', () => applyFilter(searchEl.value.trim()));

    // Accessibility: clear status once loaded
    if (items.length) statusEl.className = '';
  </script>
</body>
</html>